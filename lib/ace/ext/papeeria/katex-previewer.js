// Generated by CoffeeScript 1.10.0
(function() {
  define(function(require, exports, module) {
    exports.setupPreviewer = function(editor) {
      var callback, initKaTeX, katex;
      require("ace/ext/jquery");
      katex = null;
      initKaTeX = function() {
        var cssDemoPath, cssKatexPath, linkDemo, linkKatex, span;
        cssKatexPath = require.toUrl("../katex/katex.min.css");
        linkKatex = $("<link>").attr("rel", "stylesheet").attr("href", cssKatexPath);
        $("head").append(linkKatex);
        cssDemoPath = require.toUrl("./katex-demo.css");
        linkDemo = $("<link>").attr("rel", "stylesheet").attr("href", cssDemoPath);
        $("head").append(linkDemo);
        span = $("<span>").attr("id", "formula");
        $("body").append(span);
        require(["ace/ext/katex/katex"], function(katexInner) {
          katex = katexInner;
        });
      };
      callback = function(editor) {
        var e, error, selectedText;
        if (katex == null) {
          initKaTeX();
          setTimeout((function() {
            return callback(editor);
          }), 0);
          return;
        }
        selectedText = editor.getSelectedText();
        try {
          katex.render(selectedText, $("#formula")[0]);
        } catch (error) {
          e = error;
          $("#formula").text(e.message);
        }
      };
      editor.commands.addCommand({
        name: "previewLaTeXFormula",
        bindKey: {
          win: "Alt-p",
          mac: "Alt-p"
        },
        exec: callback
      });
    };
  });

}).call(this);
